# Sytopology design

Sytopology is a config generator for synapse. It gathers together the critical
descision points of a first time synapse install and provides a pretty ui to
walk new users through them. The result of using sytopology is a yaml file akin
to the sample config found in
[synapse's docs](https://github.com/matrix-org/synapse/tree/develop/docs) and a
knowledge of the environment in which you synapse will be running.

Sytopology can in theory run anywhere and the yaml file copied to the target
synapse, however, sytopology needs access to a local instance of synapse in
order to generate the sample configs.

The project is broken down into three parts. The api is stateless except for the
config directory which is passed to it at startup. The directory is passed to
the webui prompty after that.

   +-----------+       +-----------+       +-------------+
   |           |       |           |       |             |
   |   webui   |<----->|    api    |<----->|   synapse   |
   |           |       |           |       |             |
   +-----------+       +-----------+       +-------------+


## API

The api is a small server written using [klein](https://github.com/twisted/klein). 

The api is hosted by default on localhost:16333. It serves the static files
generated by the compiled webui and handles a number of requests from the client.
Most of these requests are for analysing the environement of the synapse install
and include information such as the availabiliy of a port on the install's box and
the existance of files indicated by the user.

Once the webui has been follow through the ui sends a json with config options
to the api, which are translated a to a more representative format and passed to
synapse. This is through a post to the `/config` endpoint.

The structure of the api is as follows:

### Api module

The api module sets up the endpoints in klein and validates each request against
a json-schema.
